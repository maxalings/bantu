<div class="m-5">
  <h3 class="text-center mb-5 text-primary">Your Requests</h3>

  <% current_user.requests.each do |request| %>
    <div class="card mb-4 border-0 shadow-sm">
      <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h5 class="mb-0 text-secondary">
          <i class="fas fa-handshake me-2"></i><%= request.service.category %>
        </h5>
        <% if request.status == 'pending' %>
          <span class="badge bg-warning text-dark">
          <%= request.status.capitalize %>
          </span>
        <% elsif request.status == 'accepted' %>
          <span class="badge bg-success">
          <%= request.status.capitalize %>
          </span>
          <% elsif request.status == 'declined' %>
            <span class="badge bg-danger">
            <%= request.status.capitalize %>
          </span>
          <% else %>
          <% end %>
      </div>

      <div class="card-body">
        <p class="card-text mb-3">
          <%= request.description %>
        </p>
        <div class="text-end">
          <!-- Assign unique id to the button and modal -->
          <button
            type="button"
            class="btn btn-outline-primary btn-sm"
            data-bs-toggle="modal"
            data-bs-target="#infoModal-<%= request.id %>">
            View Details <i class="fas fa-arrow-right ms-1"></i>
          </button>

          <!-- Modal -->
          <div class="modal fade" id="infoModal-<%= request.id %>" tabindex="-1" aria-labelledby="infoModalLabel-<%= request.id %>" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content rounded-5">
                <div class="modal-header bg-primary text-white rounded-top">
                  <h5 class="modal-title" id="infoModalLabel-<%= request.id %>">
                    <i class="fas fa-info-circle me-2"></i><%= request.service.category %>
                  </h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bg-light">
                  <div class="mb-3">
                    <h6 class="fw-bold">Description:</h6>
                    <p><%= request.description %></p>
                  </div>
                 <div class="mb-3">
                    <h6 class="fw-bold">Status:</h6>
                    <% if request.status == 'pending' %>
                      <span class="badge bg-warning text-dark">
                        <%= request.status.capitalize %>
                      </span>
                    <% elsif request.status == 'accepted' %>
                      <span class="badge bg-success">
                        <%= request.status.capitalize %>
                      </span>
                    <% elsif request.status == 'declined' %>
                      <span class="badge bg-danger">
                        <%= request.status.capitalize %>
                      </span>
                    <% else %>
                    <% end %>
                  </div>
                  <div>
                    <h6 class="fw-bold">Created At:</h6>
                    <p><%= request.created_at.strftime("%B %d, %Y %I:%M %p") %></p>
                  </div>
                  <div>
                    <h6 class="fw-bold">Request Handled by:</h6>
                    <%# add worker profile page to link to  %>
                    <img class="avatar" src="https://kitt.lewagon.com/placeholder/users/ssaunier">
                    <%=link_to "#{request.service.user.first_name} #{request.service.user.last_name}",
                    worker_path(request.service.user)%>
                  </div>
                </div>
                <div class="modal-footer bg-secondary bg-opacity-10 rounded-bottom">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- End Modal -->
        </div>
      </div>
    </div>
  <% end %>
</div>
